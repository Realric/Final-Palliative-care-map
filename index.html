<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/qgis2web.css" />
    <link rel="stylesheet" href="css/fontawesome-all.min.css" />
    <style>
      html,
      body,
      #map {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }
    </style>
    <title>
      This heatmap shows the geographical location of hospice and palliative
      care services in the WHO Eastern Mediterranean region.
    </title>
  </head>
  <body>
    <div id="map"></div>
    <!-- jQuery -->
    <script src="plugins/jquery/jquery.min.js"></script>
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="data/EMROCountries_2.js"></script>
    <script>
      /************lang translation starts***************/
      var lang = sessionStorage.getItem("lang");
      var selected1 = "";
      var selected2 = "";
      if (lang == "Arabic") {
        document.documentElement.dir = "rtl";
        //document.documentElement.lang = "ar";

        var title_translated =
          '<span style="text-align:right">تُظهر هذه الخريطة الحرارية الموقع الجغرافي لخدمات رعاية المسنين والرعاية التلطيفية في إقليم منظمة الصحة العالمية لشرق البحر الأبيض المتوسط.</span>';
        var abstract_translated =
          '<span style="text-align:end">تمت المشاركة الطوعية بالمعلومات الواردة في هذا الدليل عبر مسح أجرته المنظمة الأفريقية للرعاية التلطيفية (APCA). الإدراج في هذا الدليل لا يمثل أي تأييد او دعم من المنظمة الأفريقية للرعاية التلطيفية (APCA) او منظمة الصحة العالمية (WHO). المنظمة الأفريقية للرعاية التلطيفية غير مسئولة عن صحة ومصداقية المعلومات الواردة إذ أنه تم الإدلاء بها من قبل طرف ثالث. هذا الدليل مقصورعلى المعاهد، الدور(هوزبس) والمنظمات التي توفر خدمات الرعاية التلطيفية ورعاية هوزبس (الرعاية في نهاية الحياة). يتم وضع علامة مميزة على كل قائمة – في المواقع التي بها أكثر من قائمة، يتم عرض رقم يضم كل القوائم. يمكنك تحريك الخريطة أو تكبيرها بإستخدام أداة التكبير الموجودة على اليسار. سيؤدي النقر على النقطة إلى فتح مربع نص يحتوي على معلومات الإتصال. إذا أردت أن نقوم بإضافة خدماتك الرجاء مراسلتنا على عنوان البريد الإلكتروني: info@africanpalliativecare.org  </span>';
        selected1 = "selected";
        var guide_translated =
          '<p class="legend_title">مرشد</p><p>حدد أيقونة الطبقات لتنشيط أو إلغاء تنشيط طبقة من اختيارك. قم بتنشيط "مقدمي الخدمة" و"Google Satellite" إذا كنت ترغب في عرض مزود خدمة معين وجيرانه. قم بتفعيل "عدد مقدمي الخدمة لكل دولة" وخريطة جوجل" إذا كنت ترغب في عرض الدول التي بها أكبر عدد من مقدمي الخدمة. انقر على القائمة المنسدلة للتبديل إلى خريطة أخرى تتضمن الخريطة الحرارية والنسخة العربية.</p>';
        var service_providers_translated = "مقدمي الخدمة";
        var countries_categorized_translated =
          "تصنيف الدول حسب عدد مقدمي الخدمة";
        var year_started_translated = "السنة التي بدأت";
        var patients_served_translated = "المرضى خدموا";
        var clear_filter_translated = "مرشح واضح";
        var name_of_facility_translated = "اسم المنشأة";
        var country_translated = "البلد";
        var city_translated = "المدينة";
        var whatsapp_number_translated = "رقم واتس اب";
        var type_of_facility_translated = "نوع المنشأة";
        var total_patients_served_since_initiation_translated =
          "إجمالي المرضى الذين خدموا منذ البداية";
        var total_number_of_staff_translated = "إجمالي عدد الموظفين";
        var category_translated = "الفئة";
        var facility_dispenses_opioids_translated =
          "تقوم المنشأة بتوزيع المواد الأفيونية";
        var palliative_care_in_humaniterian_settings_translated =
          "الرعاية التلطيفية في الأوضاع الإنسانية؟";
        var facility_serves_children_translated = "المنشأة تخدم الأطفال؟";
        var website_translated = "موقع إلكتروني";
        var developed_by_translated = "طورت بواسطة";
      } else {
        title_translated =
          "This heatmap shows the distribution of hospice and palliative care services in the WHO Eastern Mediterranean region.";
        abstract_translated =
          "The information contained in this directory was voluntarily sent to APCA via a survey. Listing in this directory does not represent endorsement or support from APCA or WHO. APCA is not responsible for the accuracy and veracity of the information as it was provided by third parties. This directory is limited to institutions, hospices, and organizations that provide palliative and hospice care. Each listing is marked - in locations where more than one listing is available, a number with the total listings is displayed. You can drag or zoom in the map by using the zooming tool on the left. Clicking on the dot will open a text box with the contact information. If you would like us to add your service please email – info@africanpalliativecare.org ";
        selected2 = "selected";
        var guide_translated =
          '<p class="legend_title">GUIDE</p><p>Select the layers icon to activate or deactivate a layer of your choice. Activate the “Service providers” and “Google satellite” if you would like to view a particular service provider and its neighborhood. Activate the “Number of service providers per country” and Google map” if you wish to view the countries with the highest number of service providers. Click in the drop down to switch to another map including the Heat map and the Arabic version.</p>';
        var service_providers_translated = "Service Providers";
        var countries_categorized_translated =
          "Countries categorized according to number of service providers";
        var year_started_translated = "Year Started";
        var patients_served_translated = "Patients Served";
        var clear_filter_translated = "clear filter";
        var name_of_facility_translated = "Name of facility";
        var country_translated = "Country";
        var city_translated = "City";
        var whatsapp_number_translated = "Whatsapp number";
        var type_of_facility_translated = "Type of facility";
        var total_patients_served_since_initiation_translated =
          "Total patients served since initiation";
        var total_number_of_staff_translated = "Total number of staff";
        var category_translated = "Category";
        var facility_dispenses_opioids_translated =
          "Facility dispenses opioids";
        var palliative_care_in_humaniterian_settings_translated =
          "Palliative care in humanterian settings?";
        var facility_serves_children_translated = "Facility serves children?";
        var website_translated = "Website";
        var developed_by_translated = "Developed by";
      }
      /*************lang tarnslation ends*************************************/
      var highlightLayer;
      function highlightFeature(e) {
        highlightLayer = e.target;

        if (e.target.feature.geometry.type === "LineString") {
          highlightLayer.setStyle({
            color: "#ffff00",
          });
        } else {
          highlightLayer.setStyle({
            fillColor: "#ffff00",
            fillOpacity: 1,
          });
        }
        highlightLayer.openPopup();
      }
      var map = L.map("map", {
        zoomControl: true,
        maxZoom: 20,
        minZoom: 3,
      }).fitBounds([
        [-12.472206996971952, -28.884148962505435],
        [47.01845843355159, 83.21658892170174],
      ]);
      var hash = new L.Hash(map);
      map.attributionControl.setPrefix(
        '<span class="company_text"><span style = "font-weight:bolder">' +
          developed_by_translated +
          ': <span style = "font-weight:bolder;color:blue">MRT IT PEAKS LIMITED (UG)</span></span> </span> <a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>'
      );
      var autolinker = new Autolinker({
        truncate: { length: 30, location: "smart" },
      });
      var bounds_group = new L.featureGroup([]);
      function setBounds() {}
      map.createPane("pane_OSMStandard_0");
      map.getPane("pane_OSMStandard_0").style.zIndex = 400;
      var layer_OSMStandard_0 = L.tileLayer(
        "http://tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          pane: "pane_OSMStandard_0",
          opacity: 1.0,
          attribution:
            '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors, CC-BY-SA</a>',
          minZoom: 3,
          maxZoom: 20,
          minNativeZoom: 0,
          maxNativeZoom: 19,
        }
      );
      layer_OSMStandard_0;
      map.addLayer(layer_OSMStandard_0);
      map.createPane("pane_Heatmap_1");
      map.getPane("pane_Heatmap_1").style.zIndex = 401;
      var img_Heatmap_1 = "data/Heatmap_1.png";
      var img_bounds_Heatmap_1 = [
        [-1.048689000000003, -17.141849999999998],
        [40.851311, 78.45815000000002],
      ];
      var layer_Heatmap_1 = new L.imageOverlay(
        img_Heatmap_1,
        img_bounds_Heatmap_1,
        { pane: "pane_Heatmap_1" }
      );
      bounds_group.addLayer(layer_Heatmap_1);
      map.addLayer(layer_Heatmap_1);
      function pop_EMROCountries_2(feature, layer) {
        layer.on({
          mouseout: function (e) {
            for (i in e.target._eventParents) {
              e.target._eventParents[i].resetStyle(e.target);
            }
            if (typeof layer.closePopup == "function") {
              layer.closePopup();
            } else {
              layer.eachLayer(function (feature) {
                feature.closePopup();
              });
            }
          },
          mouseover: highlightFeature,
        });
        var popupContent =
          '<table>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["fid"] !== null
            ? autolinker.link(feature.properties["fid"].toLocaleString())
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["NAME"] !== null
            ? autolinker.link(feature.properties["NAME"].toLocaleString())
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["Type of fa"] !== null
            ? autolinker.link(feature.properties["Type of fa"].toLocaleString())
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["Patients s"] !== null
            ? autolinker.link(feature.properties["Patients s"].toLocaleString())
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["Number of"] !== null
            ? autolinker.link(feature.properties["Number of"].toLocaleString())
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["service pr"] !== null
            ? autolinker.link(feature.properties["service pr"].toLocaleString())
            : "") +
          "</td>\
                    </tr>\
                </table>";
        layer.bindPopup(popupContent, { maxHeight: 400 });
      }

      function style_EMROCountries_2_0() {
        return {
          pane: "pane_EMROCountries_2",
          opacity: 1,
          color: "rgba(136,45,10,1.0)",
          dashArray: "",
          lineCap: "square",
          lineJoin: "bevel",
          weight: 2.0,
          fillOpacity: 0,
          interactive: false,
        };
      }
      map.createPane("pane_EMROCountries_2");
      map.getPane("pane_EMROCountries_2").style.zIndex = 402;
      map.getPane("pane_EMROCountries_2").style["mix-blend-mode"] = "normal";
      var layer_EMROCountries_2 = new L.geoJson(json_EMROCountries_2, {
        attribution: "",
        interactive: false,
        dataVar: "json_EMROCountries_2",
        layerName: "layer_EMROCountries_2",
        pane: "pane_EMROCountries_2",
        onEachFeature: pop_EMROCountries_2,
        style: style_EMROCountries_2_0,
      });
      bounds_group.addLayer(layer_EMROCountries_2);
      map.addLayer(layer_EMROCountries_2);
      var title = new L.Control();
      title.onAdd = function (map) {
        this._div = L.DomUtil.create("div", "info");
        this.update();
        return this._div;
      };
      title.update = function () {
        this._div.innerHTML = "<h2>" + title_translated + "</h2>";
      };
      title.addTo(map);
      var abstract = new L.Control({ position: "topright" });
      abstract.onAdd = function (map) {
        this._div = L.DomUtil.create("div", "leaflet-control abstract");
        this._div.id = "abstract";
        this._div.setAttribute("onmouseenter", "abstract.show()");
        this._div.setAttribute("onmouseleave", "abstract.hide()");
        this.hide();
        return this._div;
      };
      abstract.hide = function () {
        this._div.classList.remove("abstractUncollapsed");
        this._div.classList.add("abstract");
        this._div.innerHTML = "i";
      };
      abstract.show = function () {
        this._div.classList.remove("abstract");
        this._div.classList.add("abstractUncollapsed");
        this._div.innerHTML = abstract_translated;
      };
      abstract.addTo(map);
      /*********************menu starts***********************/
      var menu = new L.Control({ position: "topright" });
      menu.onAdd = function (map) {
        this._div = L.DomUtil.create("div", "leaflet-control menu");
        this._div.id = "menu";
        this._div.setAttribute("onmouseenter", "menu.show()");
        this._div.setAttribute("onmouseleave", "menu.hide()");
        this.hide();
        return this._div;
      };
      menu.hide = function () {
        this._div.classList.remove("abstractUncollapsed");
        this._div.classList.add("abstract");
        this._div.innerHTML = "m";
      };
      menu.show = function () {
        this._div.classList.remove("abstract");
        this._div.classList.add("abstractUncollapsed");
        //this._div.innerHTML = menu_translated;
        this._div.innerHTML =
          '<span><select id="language"><option ' +
          selected2 +
          ' value="English">English</option><option ' +
          selected1 +
          ' value="Arabic">Arabic</option></select></span>  <span><select id="map_type"><option value="Heat_Map">Heat Map</option><option value="General_Map">General Map</option></select></span>';
      };
      menu.addTo(map);
      /*********************menu ends***********************/
      setBounds();
      var i = 0;
      layer_EMROCountries_2.eachLayer(function (layer) {
        var context = {
          feature: layer.feature,
          variables: {},
        };
        layer.bindTooltip(
          layer.feature.properties["NAME"] !== null
            ? String(
                "<div style=\"color: #323232; font-size: 10pt; font-family: 'Arial', sans-serif;\">" +
                  layer.feature.properties["NAME"]
              ) + "</div>"
            : "",
          {
            permanent: true,
            offset: [-0, -16],
            className: "css_EMROCountries_2",
          }
        );
        labels.push(layer);
        totalMarkers += 1;
        layer.added = true;
        addLabel(layer, i);
        i++;
      });
      L.ImageOverlay.include({
        getBounds: function () {
          return this._bounds;
        },
      });
      resetLabels([layer_EMROCountries_2]);
      map.on("zoomend", function () {
        resetLabels([layer_EMROCountries_2]);
      });
      map.on("layeradd", function () {
        resetLabels([layer_EMROCountries_2]);
      });
      map.on("layerremove", function () {
        resetLabels([layer_EMROCountries_2]);
      });
      /**************jquery work starts*****************/
      $(document).ready(function () {
        //on changing the language
        sessionStorage.removeItem("lang");
        sessionStorage.clear();
        $(document).on("change", "#language", function () {
          var language = $(this).children(":selected").val();
          sessionStorage.setItem("lang", language);
          window.location.href = "index.html";
        });
        $(document).on("change", "#map_type", function () {
          var map_type = $(this).children(":selected").val();
          if (map_type == "Heat_Map") {
            window.location.href = "index.html";
          } else {
            window.location.href = "../index.html";
          }
        });
      });
    </script>
  </body>
</html>
